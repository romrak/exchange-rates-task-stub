# Testing day application stub

# Assignment

```
Use this application skeleton to implement an exchange rates provider for our other services. The first version of the application will be implemented as a caching layer over a 3rd-party service.

https://github.com/shipmonk-rnd/exchange-rates-task-stub

We don't want you to spend days with this task, therefore if you'll have to decide between finishing all functionality or designing app architecture, give the architecture a priority. Nicely architected application, but not fully functional will get more points than badly architected but working app.

* Use https://fixer.io/ as exchange rates source
* Register a new account for development and testing on your personal email
* Base currency is USD
* Response shape of /api/v1/rates/{day} should be similar to what https://fixer.io/documentation responds
* Use PostgreSQL to store the cached exchange rates
* Start a local database for development using docker-compose up -d database
* You can use whatever libraries you may need
* If you have experience with Hibernate, please use it to demonstrate your knowledge
* The service will be used only internally, so securing the API is not needed
* Prioritize making the code testable, donâ€™t spend too much time writing tests for everything at the expense of other requirements. But if you want and have time for it, you can write a test or two.
* Think of edge cases that can occur in this environment and design solid error handling so that the downstream services can be simplified as much as reasonably possible.
* See test.sh for example requests

Please, don't push anything to the repo and don't fork it. Use your own GIT repo.

```

# Analysis

- we will use `Historical Rates Endpoint` and base currency is always USD
- Fixer free plan does not support base currency
- Basic plan supports all base currencies, but costs $14.99
- We need to have basic plan
- It has limit of 10k api calls per month
- It's enough for more than 27 years
- Fixer has data since 1999, and thus we should never reach the limits with basic plan

## Call examples

All requests are same, with base=USD, just date is different

| note                | request date | response                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | status code |
|---------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| before 1999         | 1998-12-31   | `{"success":false,"error":{"code":106,"type":"no_rates_available","info":"Your query did not return any results. Please try again."}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 200         |
| invalid date format | 1999-1-1     | `{"success":false,"error":{"code":302,"type":"invalid_date","info":"You have entered an invalid date. [Required format: date=YYYY-MM-DD]"}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 200         |
| free plan           | 1999-01-01   | `{"success":false,"error":{"code":105,"type":"base_currency_access_restricted"}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 304         |
| future date         | 2030-01-01   | `{"success":false,"error":{"code":302,"type":"invalid_date","info":"You have entered an invalid date. [Required format: date=YYYY-MM-DD]"}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 200         |
| success             | 2024-09-11   | `{"success":true,"timestamp":1726099199,"historical":true,"base":"USD","date":"2024-09-11","rates":{"AED":3.672996,"AFN":70.999708,"ALL":90.375019,"AMD":387.270066,"ANG":1.801722,"AOA":927.999846,"ARS":957.741278,"AUD":1.498127,"AWG":1.8025,"AZN":1.700406,"BAM":1.769739,"BBD":2.018586,"BDT":119.469567,"BGN":1.775407,"BHD":0.376848,"BIF":2898,"BMD":1,"BND":1.301525,"BOB":6.908346,"BRL":5.668902,"BSD":0.999778,"BTC":1.7436495e-5,"BTN":83.924844,"BWP":13.338159,"BYN":3.271758,"BYR":19600,"BZD":2.015156,"CAD":1.35786,"CDF":2870.000063,"CHF":0.85264,"CLF":0.034144,"CLP":942.15008,"CNY":7.120698,"CNH":7.126825,"COP":4269.98,"CRC":518.031571,"CUC":1,"CUP":26.5,"CVE":100.526725,"CZK":22.786901,"DJF":177.720197,"DKK":6.777497,"DOP":59.999825,"DZD":132.676747,"EGP":48.377598,"ERN":15,"ETB":109.801999,"EUR":0.90821,"FJD":2.22225,"FKP":0.778521,"GBP":0.76695,"GEL":2.695011,"GGP":0.778521,"GHS":15.669922,"GIP":0.778521,"GMD":71.00005,"GNF":8650.000433,"GTQ":7.728468,"GYD":209.150504,"HKD":7.797465,"HNL":24.850258,"HRK":6.868089,"HTG":131.765515,"HUF":359.709928,"IDR":15437,"ILS":3.77324,"IMP":0.778521,"INR":83.99285,"IQD":1310,"IRR":42104.999748,"ISK":138.330295,"JEP":0.778521,"JMD":156.668642,"JOD":0.708694,"JPY":142.633965,"KES":129.000034,"KGS":84.200056,"KHR":4070.000152,"KMF":446.949802,"KPW":899.99992,"KRW":1339.820274,"KWD":0.30562,"KYD":0.833085,"KZT":477.630037,"LAK":22132.503327,"LBP":89599.99956,"LKR":300.546077,"LRD":194.999989,"LSL":17.901602,"LTL":2.95274,"LVL":0.60489,"LYD":4.760161,"MAD":9.78275,"MDL":17.435327,"MGA":4534.999871,"MKD":55.877919,"MMK":3247.960992,"MNT":3397.999407,"MOP":8.029769,"MRU":39.704994,"MUR":46.050194,"MVR":15.360045,"MWK":1735.498801,"MXN":19.80974,"MYR":4.337502,"MZN":63.84992,"NAD":17.904905,"NGN":1654.999875,"NIO":36.797138,"NOK":10.85815,"NPR":134.278282,"NZD":1.630696,"OMR":0.38495,"PAB":0.999751,"PEN":3.821496,"PGK":3.911499,"PHP":56.250544,"PKR":278.802368,"PLN":3.895519,"PYG":7724.848095,"QAR":3.640499,"RON":4.517102,"RSD":106.274007,"RUB":91.575405,"RWF":1340,"SAR":3.75273,"SBD":8.334636,"SCR":13.620244,"SDG":601.499296,"SEK":10.39065,"SGD":1.30464,"SHP":0.778521,"SLE":22.847303,"SLL":20969.4682,"SOS":570.999892,"SRD":29.265996,"STD":20697.981008,"SVC":8.748252,"SYP":2512.530194,"SZL":17.930152,"THB":33.790029,"TJS":10.654415,"TMT":3.5,"TND":3.053503,"TOP":2.354249,"TRY":34.00501,"TTD":6.774493,"TWD":32.122203,"TZS":2720.000092,"UAH":41.269347,"UGX":3718.615698,"USD":1,"UYU":40.393255,"UZS":12704.999907,"VEF":3622552.534434,"VES":36.740138,"VND":24565,"VUV":118.721978,"WST":2.800923,"XAF":593.532246,"XAG":0.034869,"XAU":0.000398,"XCD":2.702551,"XDR":0.740982,"XOF":593.497423,"XPF":108.625018,"YER":250.350159,"ZAR":17.90457,"ZMK":9001.196482,"ZMW":26.417297,"ZWL":321.999592}}` | 200         |
| invalid API key     | 2024-09-11   | `{"success": false,"error": {"code": 101,"type": "invalid_access_key","info": "You have not supplied a valid API Access Key. [Technical Support: support@apilayer.com]"}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 200         |

So it is (nearly) always returning status code 200

# Decisions

- Will use basic plan, $14.99 per month
- Will use classic imperative approach, maybe I will try reactive later


# Architecture

![exchange-rates.drawio.svg](exchange-rates.drawio.svg)

white arrow indicates dependency

red arrow indicates control flow

`exchange_rate` and `repository` are interfaces or ports as stated in hexagonal architecture
